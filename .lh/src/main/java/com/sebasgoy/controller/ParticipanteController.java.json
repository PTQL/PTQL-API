{
    "sourceFile": "src/main/java/com/sebasgoy/controller/ParticipanteController.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1717176707875,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1717176714062,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,7 @@\n package com.sebasgoy.controller;\r\n \r\n import com.sebasgoy.dto.Actividad;\r\n-import com.sebasgoy.dto.Modulo;\r\n import com.sebasgoy.dto.Participante;\r\n import com.sebasgoy.dto.Voluntario;\r\n import com.sebasgoy.dto.response.AsistenciaRespone;\r\n import com.sebasgoy.service.ActividadService;\r\n"
                }
            ],
            "date": 1717176707875,
            "name": "Commit-0",
            "content": "package com.sebasgoy.controller;\r\n\r\nimport com.sebasgoy.dto.Actividad;\r\nimport com.sebasgoy.dto.Modulo;\r\nimport com.sebasgoy.dto.Participante;\r\nimport com.sebasgoy.dto.Voluntario;\r\nimport com.sebasgoy.dto.response.AsistenciaRespone;\r\nimport com.sebasgoy.service.ActividadService;\r\nimport com.sebasgoy.service.ModuloService;\r\nimport com.sebasgoy.service.ParticipanteService;\r\nimport com.sebasgoy.service.VoluntarioService;\r\nimport com.sebasgoy.constantes.Mensajes;\r\nimport com.sebasgoy.constantes.Modalidades;\r\n\r\nimport com.sebasgoy.util.Tools;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport lombok.AllArgsConstructor;\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.ui.Model;\r\nimport org.springframework.web.bind.annotation.*;\r\n\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\n@Controller\r\n@AllArgsConstructor\r\npublic class ParticipanteController {\r\n\r\n\tprivate final ParticipanteService participanteService;\r\n\tprivate final ActividadService actividadService;\r\n\tprivate final VoluntarioService voluntarioService;\r\n\t@GetMapping(\"/change_participacion/{id}\")\r\n\tpublic String change_participacion(@PathVariable(\"id\") Long idParticipante ,Model model,\r\n\t\t\tHttpServletRequest request) {\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\r\n\t\ttry {\r\n\t\t\tParticipante participante = participanteService.findById(idParticipante);\r\n\t\t\tparticipante.changeParticipacion();\r\n\t\t\tparticipanteService.saveParticipante(participante);\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tSystem.out.println(Mensajes.success(\"PARTICIPANTE\", \"BUSQUEDA\"));\r\n\r\n\t\t} catch (Exception e) {\r\n\t\t\t// TODO: handle exception\r\n\t\t\tSystem.out.println(Mensajes.error(\"PARTICIPANTE\", \"BUSQUEDA\").concat(e.getMessage()));\r\n\r\n\t\t}\r\n\t\t\r\n\t\treturn Tools.paginaAnterior(request);\r\n\t}\r\n\t\r\n\t\r\n\t@GetMapping(\"/editar_voluntario_formParticipante/{id}\")\r\n\tpublic String editar_voluntario(@PathVariable(\"id\")Long idParticipante,Model model) {\r\n\t\t\r\n\t\tParticipante participante = participanteService.findById(idParticipante);\r\n\r\n\t\ttry {\r\n \t\t\tmodel.addAttribute(\"voluntario\", participante.getVoluntario());\r\n\t\t\tmodel.addAttribute(\"actividad\",participante.getActividad());\r\n \t\t\tSystem.out.println(Mensajes.success(\"PARTICIPANTE\",\"BUSQUEDA\"));\r\n\r\n\t\t\treturn \"FormNewVoluntario\";\r\n\t\t} catch (Exception e) {\r\n\t\t\t\r\n\t\t\tSystem.out.println(Mensajes.error(\"PARTICIPANTE\",\"BUSQUEDA\") +e.toString());\r\n\t\t}\r\n\t\treturn \"/info_actividad/\".concat(participante.getIdActividad().toString());\r\n\t\t\r\n\t}\r\n\t\r\n\t@GetMapping(\"/retirar_voluntario/{id}\")\r\n\tpublic String retirar_voluntario(@PathVariable(\"id\")Long idParticipante ,Model model,HttpServletRequest request)  {\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\r\n\t\ttry {\r\n \t\t\tparticipanteService.deleteParticipanteById(idParticipante);\r\n\t\t\tSystem.out.println(Mensajes.success(\"PARTICIPANTE\",\"Eliminacion\"));\r\n\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(Mensajes.error(\"PARTICIPANTE\",\"Eliminacion\") +e.toString());\r\n\t\t}\r\n\t\treturn \"redirect:\"+pagina_anterior;\r\n\t}\r\n\t\r\n\t@GetMapping(\"/retirar_todos_voluntarios/{id}\")\r\n\tpublic String retirar_todos_voluntarios(@PathVariable(\"id\")Long idActividad ,Model model,HttpServletRequest request)  {\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\t\t\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\tActividad actividad = actividadService.findById(idActividad);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tactividad.getParticipante().forEach(\r\n\t\t\t\t(x) -> {\r\n\t\t\t\t\tparticipanteService.deleteParticipanteById(x.getId());\r\n\t\t\t\t});\r\n\t\t\t\r\n \t\t\tSystem.out.println(Mensajes.success(\"Actividad - Participante - Voluntario\",\"Eliminacion\"));\r\n\t\t\t\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(Mensajes.error(\"Actividad - Participante - Voluntario\",\"Eliminacion\") +e.toString());\r\n\t\t}\r\n\t\treturn \"redirect:\"+pagina_anterior;\r\n\t}\r\n\r\n\r\n\r\n\r\n\t@PostMapping(\"/incluirVoluntarios\")\r\n\tpublic String incluirVoluntarios(\r\n\t\t\tModel model,\r\n\t\t\tHttpServletRequest  request,\r\n\t\t\t@RequestParam(\"idActividad\") Long idActividad,\r\n\t\t\t@RequestParam(\"voluntariosSeleccionados\") List<Long> voluntariosSeleccionados\r\n\t){\r\n \t\ttry {\r\n\r\n\t\t\tparticipanteService.saveVoluntariosToActividad(voluntariosSeleccionados, idActividad, Modalidades.ID_LIBRE,true);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\treturn \"redirect:/info_actividad/\"+idActividad;\r\n\r\n\r\n\r\n\t\t}catch (Exception e){\r\n\t\t\tSystem.out.println(Mensajes.error(\"VOLUNTARIO\", \"Registro\"));\r\n\t\t\treturn Tools.paginaAnterior(request);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t@PostMapping(\"/leerParticipantesFromTxt/{id}\")\r\n\tpublic String leerVoluntariosFromTxt(\r\n\t\t\tHttpServletRequest  request,\r\n\t\t\t@PathVariable(\"id\") Long idActividad,\r\n\t\t\tModel model,\r\n    \t\t@RequestParam(value=\"type\") String action,\r\n\t\t\t@RequestParam(\"dni\") String dnis\r\n\t\t\t){\r\n \r\n        AsistenciaRespone asistenciaResponse = participanteService.verDetallesListOfDni(idActividad, model, dnis);\r\n\r\n\t\tif (action.equals(\"verDetalles\")) {\r\n\t\t\ttry {\r\n\t\t\t\tmodel.addAttribute(\"actividad\",actividadService.findById(idActividad));\r\n\t\t\t\tmodel.addAttribute(\"asistenciaRespone\",asistenciaResponse \t);\r\n\t\t        \r\n\t\t\t\treturn \"gestorAsistencia/GestorAsistencia\";\r\n\t\t\t} catch (Exception e) {\r\n\t\t\t\tSystem.out.println(Mensajes.error(\"VOLUNTARIO\", \"Registro\") + e.getMessage());\r\n\t\t\t\treturn \"redirect:/dashboard_voluntario\";\t\t\r\n\t\t\t}\r\n\t \r\n\t\t}else if (action.equals(\"marcarAsistencia\")) {\r\n\r\n\t\t\tList<Voluntario> voluntarios_guardados = voluntarioService.saveAndGetVoluntarios(asistenciaResponse.getLstNoRegistrados());\r\n\t\t\tList<Participante> participante_creados_libre = participanteService.saveVoluntariosToActividadAndGetParticipantes(voluntarios_guardados,idActividad,Modalidades.ID_LIBRE);\r\n\r\n\t\t\tparticipanteService.makeParticipantionTrue(participante_creados_libre);\r\n\t\t\tparticipanteService.makeParticipantionTrue(asistenciaResponse.getLstRegistrados());\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\treturn \"redirect:/info_actividad/\"+idActividad;\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n \r\n\t\r\n\t\r\n\t\r\n\t\r\n\r\n\r\n\r\n\t\r\n}\r\n"
        }
    ]
}