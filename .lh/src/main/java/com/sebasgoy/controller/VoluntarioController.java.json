{
    "sourceFile": "src/main/java/com/sebasgoy/controller/VoluntarioController.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1717176722039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1717176746194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -143,9 +143,8 @@\n \t}\r\n \t@PostMapping(\"/guardar_voluntario\")\r\n \tpublic String guardar_voluntario(HttpServletRequest  request ,@ModelAttribute Voluntario voluntario,\r\n \t\t\t Model model ) {\r\n-\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n \t\ttry {\r\n \t\t\t\r\n \t\t\tvoluntarioService.saveVoluntario(voluntario);\r\n \t\t\t\r\n"
                },
                {
                    "date": 1717176755611,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -193,10 +193,8 @@\n \t\t\tModel model,\r\n \t\t\t@RequestParam(\"nombres\") String nombres\r\n \t\t\t){\r\n \r\n-\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n-\r\n \t\ttry {\r\n \t\t\tSystem.out.println(\"Iniciando lectura de Txt\");\r\n \t        List<String> listaNombres = Arrays.asList(nombres.split(\"\\\\r?\\\\n\"));\r\n \t        \r\n"
                }
            ],
            "date": 1717176722039,
            "name": "Commit-0",
            "content": "package com.sebasgoy.controller;\r\n\r\n \r\nimport com.sebasgoy.dto.Actividad;\r\nimport com.sebasgoy.dto.Participante;\r\nimport com.sebasgoy.dto.Voluntario;\r\nimport com.sebasgoy.service.ActividadService;\r\nimport com.sebasgoy.service.ParticipanteService;\r\nimport com.sebasgoy.service.TipoParticipacionService;\r\nimport com.sebasgoy.service.VoluntarioService;\r\n\r\nimport com.sebasgoy.constantes.Mensajes;\r\nimport com.sebasgoy.constantes.Modalidades;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport lombok.AllArgsConstructor;\r\n\r\nimport java.util.Arrays;\r\nimport java.util.Collection;\r\nimport java.util.Collections;\r\nimport java.util.List;\r\n\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.ui.Model;\r\nimport org.springframework.web.bind.annotation.*;\r\n\r\n \r\n\r\n@Controller\r\n@AllArgsConstructor\r\npublic class VoluntarioController {\r\n\t\r\n\t\r\n\tprivate final VoluntarioService voluntarioService;\r\n\tprivate final TipoParticipacionService TipoParticipacionService;\r\n\tprivate final ActividadService actividadService;\r\n\tprivate final ParticipanteService participanteService;\r\n\t\r\n\r\n\t@GetMapping(\"/dashboard_voluntario\")\r\n\tpublic String dashboard_voluntario(Model model) {\r\n\t\ttry {\r\n\t\t\tList<Voluntario> voluntarios = voluntarioService.getAll();\r\n\t\t\tCollections.reverse(voluntarios);\r\n\t\t\tmodel.addAttribute(\"listaVoluntarios\",voluntarios);\r\n\t\t\t\r\n\t\t\treturn \"DashboardVoluntarios\";\r\n\t\t} catch (Exception e) {\r\n\t\t\t// TODO: handle exception\r\n\t\t}\r\n\t\treturn \"redirect:/\";\r\n\r\n\t}\r\n\t@GetMapping(\"/editar_voluntario/{id}\")\r\n\tpublic String editar_voluntario(@PathVariable(\"id\")Long id,Model model) {\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tmodel.addAttribute(\"voluntario\", voluntarioService.findById(id));\r\n\t\t\tSystem.out.println(Mensajes.success(\"Voluntario\", \"Busqueda\"));\r\n\r\n\t\t\treturn \"FormNewVoluntario\";\r\n\t\t} catch (Exception e) {\r\n\r\n\t\t\tSystem.out.println(Mensajes.error(\"Voluntario\", \"Busqueda\"));\r\n\t\t\t\r\n\t\t}\r\n\t\treturn \"redirect:/dashboard_voluntario\";\r\n\r\n\t}\r\n\t\r\n\t@GetMapping(\"/info_voluntario/{id}\")\r\n\tpublic String info_voluntario(@PathVariable(\"id\")Long id,Model model) {\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\tVoluntario voluntario = voluntarioService.findById(id);\r\n \r\n\t\t\t\r\n\t\t\tList<Participante> actividadesVoluntario = voluntario.getParticipante().stream()\r\n\t\t\t\t\t.filter(participante -> participante.getIdTipoParticipacion()\r\n\t\t\t\t\t\t\t.equals(TipoParticipacionService.findByDescripcion(Modalidades.LIBRE).getId()))\r\n\t\t\t\t\t.toList();\r\n\t\t\t\r\n\t\t\tList<Participante> moduloVoluntario = voluntario.getParticipante().stream()\r\n\t\t\t\t\t.filter(participante -> participante.getIdTipoParticipacion()\r\n\t\t\t\t\t\t\t.equals(TipoParticipacionService.findByDescripcion(Modalidades.MODULO).getId()) )\r\n\t\t\t\t\t.toList();\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tmodel.addAttribute(\"voluntario\",voluntario);\r\n\t\t\tmodel.addAttribute(\"moduloVoluntario\",moduloVoluntario);\r\n\t\t\tmodel.addAttribute(\"actividadesVoluntario\",actividadesVoluntario);\r\n\t\t\t\r\n\t\t\treturn \"InfoVoluntario\";\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(Mensajes.error(\"Voluntario\", \"Buscar\").concat(e.toString()));\r\n\r\n\t\t}\r\n\t\treturn \"redirect:/dashboard_voluntario\";\r\n\r\n\t\t\r\n\t}\r\n\t@GetMapping(\"/eliminar_voluntario/{id}\")\r\n\tpublic String desactivar_voluntario(@PathVariable(\"id\")Long id,Model model) {\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\tVoluntario voluntario = voluntarioService.findById(id);\r\n\t\t\tList<Participante> listParticipante = voluntario.getParticipante();\r\n\t\t\t\r\n\t\t\tparticipanteService.deleteListOfParticipante(listParticipante);\r\n\t\t\tSystem.out.println(Mensajes.success(\"Participante\", \"Eliminacion\"));\r\n\r\n\t\t\t\r\n\t\t\tvoluntarioService.deleteVoluntario(voluntario);\r\n\t\t\t\r\n\t\t\tmodel.addAttribute(\"voluntario\", voluntarioService.getAll());\r\n\t\t\tSystem.out.println(Mensajes.success(\"Voluntario\", \"Eliminacion\"));\r\n\r\n\t\t} catch (Exception e) {\r\n\r\n\t\t\tSystem.out.println(Mensajes.error(\"Voluntario\", \"Eliminacion\").concat(e.toString()));\r\n\t\t\t\r\n\t\t}\r\n\t\treturn \"redirect:/dashboard_voluntario\";\r\n\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t@GetMapping(\"/generar_voluntario\")\r\n\tpublic String generar_voluntario(\r\n\t\t\tModel model\r\n\t){\r\n\t\tmodel.addAttribute(\"voluntario\",\r\n\r\n\t\t\t\tVoluntario.builder()\r\n\t\t\t\t\t\t.Id(voluntarioService.UltimoId())\r\n\t\t\t\t\t\t.estado(true)\r\n\t\t\t\t\t\t.build()\r\n\t\t\t\t);\r\n\r\n\t\treturn  \"FormNewVoluntario\";\r\n\t}\r\n\t@PostMapping(\"/guardar_voluntario\")\r\n\tpublic String guardar_voluntario(HttpServletRequest  request ,@ModelAttribute Voluntario voluntario,\r\n\t\t\t Model model ) {\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\t\ttry {\r\n\t\t\t\r\n\t\t\tvoluntarioService.saveVoluntario(voluntario);\r\n\t\t\t\r\n\t\t\tSystem.out.println(Mensajes.success(\"VOLUNTARIO\", \"REGISTRO\"));\r\n\t\t\t\r\n\t\t\t\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(Mensajes.error(\"VOLUNTARIO\", \"REGISTRO\"));\r\n\t\t}\r\n\t\t\r\n\t\treturn \"redirect:/dashboard_voluntario\";\r\n\t\t\r\n\t}\r\n\r\n \r\n\t\r\n\t@GetMapping(\"/agregarVoluntarioToActividad/{id}\")\r\n\tpublic String agregarVoluntarioToActividad(\r\n\t\t\tHttpServletRequest  request,\r\n\t\t\t@PathVariable(\"id\")Long idActividad,\r\n\t\t\tModel model\r\n\t){\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\r\n\t\ttry {\r\n\r\n\t\tActividad actividad = actividadService.findById(idActividad);\r\n\t\tList<Voluntario> listVoluntario = voluntarioService.getAllWithoutActivity(actividad);\r\n\r\n\t\tmodel.addAttribute(\"actividad\",actividad);\r\n\t\tmodel.addAttribute(\"listVoluntario\",listVoluntario);\r\n\t\treturn \"IncluirVoluntario\";\r\n\r\n\t\t}catch (Exception e){\r\n\r\n\t\t\tSystem.out.println(Mensajes.error(\"VOLUNTARIO\", \"BUSQUEDA\"));\r\n\t\t\treturn \"redirect:\"+pagina_anterior;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t\r\n\t@PostMapping(\"/leerVoluntariosFromTxt\")\r\n\tpublic String leerVoluntariosFromTxt(\r\n\t\t\tHttpServletRequest  request,\r\n\t\t\tModel model,\r\n\t\t\t@RequestParam(\"nombres\") String nombres\r\n\t\t\t){\r\n\r\n\t\tString pagina_anterior = request.getHeader(\"referer\");\r\n\r\n\t\ttry {\r\n\t\t\tSystem.out.println(\"Iniciando lectura de Txt\");\r\n\t        List<String> listaNombres = Arrays.asList(nombres.split(\"\\\\r?\\\\n\"));\r\n\t        \r\n\t        listaNombres.toString();\r\n        \t//TODO agregar validaciones\r\n\t        for (String nombre : listaNombres) {\r\n\t\t\t\t\r\n\t        \tvoluntarioService.saveVoluntario(\r\n\t        \t\t\tVoluntario.builder()\r\n\t        \t\t\t.dni(\"\")\r\n\t        \t\t\t.edad(\"\")\r\n\t        \t\t\t.correo(\"\")\r\n\t        \t\t\t.Id(voluntarioService.UltimoId())\r\n\t        \t\t\t.nombre(nombre)\r\n\t        \t\t\t.estado(true).build());\r\n\t\t\t}\r\n\t\t\tSystem.out.println(\"Finalizando lectura de Txt\");\r\n\r\n\t        \t\t\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(Mensajes.error(\"VOLUNTARIO\", \"Registro\") + e.getMessage());\r\n\t\t} \r\n\t\treturn \"redirect:/dashboard_voluntario\";\t\t\r\n\r\n\t\t\r\n\t}\r\n\r\n\r\n}\r\n"
        }
    ]
}